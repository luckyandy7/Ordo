<!DOCTYPE html>
<html lang="ko">
  <head>
    <!-- 문서 메타 정보 설정 -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ordo - Sign up</title>
    
    <!-- 스타일시트 및 폰트 연결 -->
    <link rel="stylesheet" href="/Signup/styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Cutive:wght@400&family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    
    <!-- 커스텀 폰트 정의 -->
    <style>
      @font-face {
        font-family: "Freesentation";
        src: url("/font/Freesentation.ttf") format("truetype");
      }
    </style>
  </head>
  <body class="loaded">
    <!-- 메인 컨테이너 - 왼쪽 브랜딩 섹션과 오른쪽 회원가입 폼으로 구성 -->
    <div class="container">
      <!-- 테마 변경 버튼 (다크모드/라이트모드 전환) -->
      <button id="themeToggle" class="theme-toggle" title="다크모드 토글">
        <span class="theme-icon">🌙</span>
      </button>

      <!-- 왼쪽 브랜딩 섹션: Ordo 로고와 브랜드 메시지 표시 -->
      <div class="branding-section">
        <div class="brand-content">
          <!-- 브랜드 헤더: 로고와 제목 -->
          <div class="brand-header">
            <img src="/Login/image-8.png" alt="Ordo Logo" class="brand-logo" />
            <h1 class="brand-title font-cutive">Ordo</h1>
          </div>
          
          <!-- 브랜드 슬로건 -->
          <h2 class="brand-headline">
            <span class="font-cutive">Your life,</span><br />
            <span class="highlight font-cutive">more organized</span>
          </h2>
          
          <!-- 브랜드 설명 텍스트 -->
          <p class="brand-description">
            AI가 정리하고, 당신은 집중하세요.<br />
            체계적이고 효율적인 일상을 시작해보세요.
          </p>
        </div>
      </div>

      <!-- 오른쪽 회원가입 폼 섹션 -->
      <div class="form-section">
        <div class="signup-card">
          <!-- 회원가입 제목 및 안내 메시지 -->
          <div class="signup-header">
            <h2 class="signup-title">
              <span class="font-cutive" style="color: #c96342"
                >Create account</span
              >
            </h2>
            <p class="signup-subtitle">Ordo와 함께 새로운 시작을 해보세요</p>
          </div>

          <!-- 회원가입 입력 폼 -->
          <form id="signupForm" class="signup-form">
            <!-- 이름 입력 필드 -->
            <div class="form-group">
              <label for="name">이름</label>
              <div class="input-wrapper">
                <span class="input-icon">👤</span>
                <input
                  type="text"
                  id="name"
                  name="name"
                  placeholder="이름을 입력하세요"
                  required
                />
              </div>
            </div>

            <!-- 이메일 입력 필드 -->
            <div class="form-group">
              <label for="email">이메일</label>
              <div class="input-wrapper">
                <span class="input-icon">📧</span>
                <input
                  type="email"
                  id="email"
                  name="email"
                  placeholder="이메일을 입력하세요"
                  required
                />
              </div>
            </div>

            <!-- 비밀번호 입력 필드 및 강도 표시 -->
            <div class="form-group">
              <label for="password">비밀번호</label>
              <div class="input-wrapper">
                <span class="input-icon">🔒</span>
                <input
                  type="password"
                  id="password"
                  name="password"
                  placeholder="비밀번호를 입력하세요"
                  required
                />
                <!-- 비밀번호 표시/숨김 토글 버튼 -->
                <button
                  type="button"
                  class="password-toggle"
                  id="passwordToggle"
                >
                  👁️
                </button>
              </div>
              <!-- 비밀번호 강도 표시 바 -->
              <div class="password-strength">
                <div class="strength-bar">
                  <div class="strength-fill"></div>
                </div>
                <span class="strength-text">비밀번호 강도</span>
              </div>
            </div>

            <!-- 비밀번호 확인 입력 필드 -->
            <div class="form-group">
              <label for="confirmPassword">비밀번호 확인</label>
              <div class="input-wrapper">
                <span class="input-icon">🔐</span>
                <input
                  type="password"
                  id="confirmPassword"
                  name="confirmPassword"
                  placeholder="비밀번호를 다시 입력하세요"
                  required
                />
                <!-- 비밀번호 확인 표시/숨김 토글 버튼 -->
                <button
                  type="button"
                  class="password-toggle"
                  id="confirmPasswordToggle"
                >
                  👁️
                </button>
              </div>
              <!-- 비밀번호 일치 여부 표시 -->
              <div class="password-match" id="passwordMatch"></div>
            </div>

            <!-- 이용약관 동의 체크박스 -->
            <div class="form-options">
              <label class="terms-agree">
                <input type="checkbox" id="agreeTerms" required />
                <span class="checkmark"></span>
                <span class="terms-text">
                  <a
                    href="#"
                    class="terms-link"
                    onclick="showTermsMessage(event)"
                    >이용약관</a
                  >
                  및
                  <a
                    href="#"
                    class="privacy-link"
                    onclick="showPrivacyMessage(event)"
                    >개인정보처리방침</a
                  >에 동의합니다
                </span>
              </label>
            </div>

            <!-- 회원가입 제출 버튼 -->
            <button type="submit" class="signup-btn">
              <span class="btn-text font-cutive">Create account</span>
              <div class="btn-loader"></div>
            </button>
          </form>

          <!-- 구분선 -->
          <div class="divider">
            <span class="font-cutive">or</span>
          </div>

          <!-- 소셜 로그인 버튼들 -->
          <div class="social-signup">
            <!-- 구글 회원가입 버튼 -->
            <button
              class="social-btn google-btn"
              onclick="location.href='/auth/google'"
            >
              <img src="/Login/logo-google-g-icon-1.svg" alt="Google" />
              <span class="font-cutive">Continue with Google</span>
            </button>

            <!-- 카카오 회원가입 버튼 -->
            <button class="social-btn kakao-btn" onclick="signupWithKakao()">
              <img src="/Login/KakaoTalk_logo.svg" alt="Kakao" />
              <span>Kakao로 계속하기</span>
            </button>
          </div>

          <!-- 기존 계정 로그인 링크 -->
          <div class="login-section">
            <p class="login-text">
              <span class="font-cutive">Already have an account?</span>
              <a href="/Login/email-login.html" class="login-link font-cutive"
                >Sign in</a
              >
            </p>
          </div>
        </div>
      </div>

      <!-- 배경 장식 요소들 (애니메이션 효과를 위한 원형 장식) -->
      <div class="bg-decoration">
        <div class="decoration-circle circle-1"></div>
        <div class="decoration-circle circle-2"></div>
        <div class="decoration-circle circle-3"></div>
      </div>
    </div>

    <!-- 로딩 상태 표시 오버레이 -->
    <div id="loadingOverlay" class="loading-overlay">
      <div class="loading-spinner"></div>
      <p class="loading-text">회원가입 중...</p>
    </div>

    <!-- 알림 메시지 모달 -->
    <div id="alertModal" class="alert-modal">
      <div class="alert-content">
        <div class="alert-icon">⚠️</div>
        <h3 id="alertTitle">알림</h3>
        <p id="alertMessage">메시지</p>
        <button id="alertOk" class="alert-btn">확인</button>
      </div>
    </div>

    <script>
      // ==================== 전역 변수 및 초기화 ====================
      
      /**
       * 현재 테마 상태 관리 (light/dark)
       * localStorage에서 저장된 테마를 불러오거나 기본값으로 light 사용
       */
      let currentTheme = localStorage.getItem("theme") || "light";

      /**
       * 페이지 로드 완료 시 실행되는 초기화 함수
       * 테마 적용, 회원가입 기능 초기화, 애니메이션 초기화 등을 수행
       */
      document.addEventListener("DOMContentLoaded", () => {
        applyTheme(currentTheme);
        initializeSignup();
        initializeScrollAnimations();

        // 페이지 로딩 애니메이션 완료 처리
        setTimeout(() => {
          document.body.classList.remove("loading");
          document.body.classList.add("loaded");
        }, 100);
      });

      // ==================== 테마 관리 함수 ====================
      
      /**
       * 선택된 테마를 페이지에 적용하는 함수
       * @param {string} theme - 적용할 테마 ('light' 또는 'dark')
       */
      function applyTheme(theme) {
        // HTML 문서에 테마 속성 설정
        document.documentElement.setAttribute("data-theme", theme);
        
        // 테마 토글 버튼의 아이콘 변경 (달 → 해, 해 → 달)
        const themeIcon = document.querySelector(".theme-icon");
        if (themeIcon) {
          themeIcon.textContent = theme === "dark" ? "☀️" : "🌙";
        }
        
        // 선택된 테마를 localStorage에 저장
        localStorage.setItem("theme", theme);
      }

      // ==================== 회원가입 기능 초기화 ====================
      
      /**
       * 회원가입 페이지의 모든 기능을 초기화하는 함수
       * 이벤트 리스너 등록, 비밀번호 관련 기능 설정 등
       */
      function initializeSignup() {
        // 테마 토글 버튼 이벤트 리스너 등록
        const themeToggle = document.getElementById("themeToggle");
        if (themeToggle) {
          themeToggle.addEventListener("click", () => {
            // 현재 테마와 반대 테마로 변경
            currentTheme = currentTheme === "light" ? "dark" : "light";
            applyTheme(currentTheme);
          });
        }

        // 비밀번호 표시/숨김 토글 기능 설정
        setupPasswordToggle("passwordToggle", "password");
        setupPasswordToggle("confirmPasswordToggle", "confirmPassword");

        // 비밀번호 강도 체크 기능 설정
        const passwordInput = document.getElementById("password");
        if (passwordInput) {
          passwordInput.addEventListener("input", checkPasswordStrength);
        }

        // 비밀번호 일치 확인 기능 설정
        const confirmPasswordInput = document.getElementById("confirmPassword");
        if (confirmPasswordInput) {
          confirmPasswordInput.addEventListener("input", checkPasswordMatch);
        }

        // 회원가입 폼 제출 이벤트 리스너 등록
        const signupForm = document.getElementById("signupForm");
        if (signupForm) {
          signupForm.addEventListener("submit", handleSignup);
        }

        // 입력 필드 포커스 효과 설정
        const inputs = document.querySelectorAll("input");
        inputs.forEach((input) => {
          // 입력 필드에 포커스 시 스타일 변경
          input.addEventListener("focus", () => {
            input.parentElement.classList.add("focused");
          });

          // 입력 필드에서 포커스 해제 시 스타일 복원 (값이 없는 경우)
          input.addEventListener("blur", () => {
            if (!input.value) {
              input.parentElement.classList.remove("focused");
            }
          });
        });
      }

      // ==================== 비밀번호 관련 기능 ====================
      
      /**
       * 비밀번호 표시/숨김 토글 기능을 설정하는 함수
       * @param {string} toggleId - 토글 버튼의 ID
       * @param {string} inputId - 비밀번호 입력 필드의 ID
       */
      function setupPasswordToggle(toggleId, inputId) {
        const toggle = document.getElementById(toggleId);
        const input = document.getElementById(inputId);

        if (toggle && input) {
          toggle.addEventListener("click", () => {
            // 현재 입력 타입에 따라 password ↔ text 전환
            const type =
              input.getAttribute("type") === "password" ? "text" : "password";
            input.setAttribute("type", type);
            
            // 아이콘도 함께 변경 (눈 → 닫힌 눈)
            toggle.textContent = type === "password" ? "👁️" : "🙈";
          });
        }
      }

      /**
       * 비밀번호 강도를 실시간으로 체크하고 표시하는 함수
       * 길이, 대소문자, 숫자, 특수문자 포함 여부에 따라 강도 결정
       */
      function checkPasswordStrength() {
        const password = document.getElementById("password").value;
        const strengthBar = document.querySelector(".strength-fill");
        const strengthText = document.querySelector(".strength-text");

        let strength = 0;
        let text = "매우 약함";
        let color = "#f44336";

        // 비밀번호 강도 조건 체크
        if (password.length >= 8) strength++; // 8자 이상
        if (/[a-z]/.test(password)) strength++; // 소문자 포함
        if (/[A-Z]/.test(password)) strength++; // 대문자 포함
        if (/[0-9]/.test(password)) strength++; // 숫자 포함
        if (/[^A-Za-z0-9]/.test(password)) strength++; // 특수문자 포함

        // 강도에 따른 텍스트와 색상 설정
        switch (strength) {
          case 0:
          case 1:
            text = "매우 약함";
            color = "#f44336";
            break;
          case 2:
            text = "약함";
            color = "#ff9800";
            break;
          case 3:
            text = "보통";
            color = "#ffeb3b";
            break;
          case 4:
            text = "강함";
            color = "#8bc34a";
            break;
          case 5:
            text = "매우 강함";
            color = "#4caf50";
            break;
        }

        // 강도 바와 텍스트 업데이트
        strengthBar.style.width = `${(strength / 5) * 100}%`;
        strengthBar.style.backgroundColor = color;
        strengthText.textContent = `비밀번호 강도: ${text}`;
        strengthText.style.color = color;
      }

      /**
       * 비밀번호와 비밀번호 확인 필드의 일치 여부를 체크하는 함수
       */
      function checkPasswordMatch() {
        const password = document.getElementById("password").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;
        const matchDiv = document.getElementById("passwordMatch");

        // 비밀번호 확인 필드가 비어있으면 메시지 표시 안 함
        if (confirmPassword === "") {
          matchDiv.textContent = "";
          return;
        }

        // 비밀번호 일치 여부에 따른 메시지 표시
        if (password === confirmPassword) {
          matchDiv.textContent = "✅ 비밀번호가 일치합니다";
          matchDiv.style.color = "#4caf50";
        } else {
          matchDiv.textContent = "❌ 비밀번호가 일치하지 않습니다";
          matchDiv.style.color = "#f44336";
        }
      }

      // ==================== 회원가입 처리 ====================
      
      /**
       * 회원가입 폼 제출을 처리하는 비동기 함수
       * 입력값 검증, 서버 요청, 응답 처리 등을 수행
       * @param {Event} e - 폼 제출 이벤트 객체
       */
      async function handleSignup(e) {
        e.preventDefault(); // 기본 폼 제출 동작 방지

        const name = document.getElementById("name").value;
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;
        const agreeTerms = document.getElementById("agreeTerms").checked;

        if (!name || !email || !password || !confirmPassword) {
          showAlert("입력 오류", "모든 필드를 입력해주세요.");
          return;
        }

        if (password !== confirmPassword) {
          showAlert("비밀번호 오류", "비밀번호가 일치하지 않습니다.");
          return;
        }

        if (!agreeTerms) {
          showAlert(
            "약관 동의",
            "이용약관 및 개인정보처리방침에 동의해주세요."
          );
          return;
        }

        showLoading(true);

        try {
          const response = await fetch("/api/signup", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              name,
              email,
              password,
            }),
          });

          const data = await response.json();

          if (response.ok) {
            // 회원가입 성공 시 자동 로그인 처리
            if (data.data && data.data.token && data.data.user) {
              // 토큰과 사용자 정보 저장
              localStorage.setItem("token", data.data.token);
              localStorage.setItem("user", JSON.stringify(data.data.user));

              console.log("회원가입 성공 - 자동 로그인 처리:", data.data.user);

              showAlert(
                "회원가입 완료",
                `환영합니다, ${data.data.user.name}님! 메인 페이지로 이동합니다.`,
                () => {
                  window.location.href = "/Main/index.html";
                }
              );
            } else {
              // 토큰이 없으면 로그인 페이지로
              showAlert(
                "회원가입 완료",
                "환영합니다! 로그인 페이지로 이동합니다.",
                () => {
                  window.location.href = "/Login/email-login.html";
                }
              );
            }
          } else {
            showAlert(
              "회원가입 실패",
              data.message || "회원가입에 실패했습니다."
            );
          }
        } catch (error) {
          console.error("Signup error:", error);
          showAlert(
            "연결 오류",
            "서버에 연결할 수 없습니다. 잠시 후 다시 시도해주세요."
          );
        } finally {
          showLoading(false);
        }
      }

      // 로딩 표시
      function showLoading(show) {
        const overlay = document.getElementById("loadingOverlay");
        const signupBtn = document.querySelector(".signup-btn");

        if (show) {
          overlay.classList.add("show");
          signupBtn.classList.add("loading");
          signupBtn.disabled = true;
        } else {
          overlay.classList.remove("show");
          signupBtn.classList.remove("loading");
          signupBtn.disabled = false;
        }
      }

      // 알림 모달
      function showAlert(title, message, callback) {
        const modal = document.getElementById("alertModal");
        const titleEl = document.getElementById("alertTitle");
        const messageEl = document.getElementById("alertMessage");
        const okBtn = document.getElementById("alertOk");

        titleEl.textContent = title;
        messageEl.textContent = message;
        modal.classList.add("show");

        okBtn.onclick = () => {
          modal.classList.remove("show");
          if (callback) callback();
        };
      }

      // 카카오 회원가입
      function signupWithKakao() {
        showAlert("준비 중", "카카오 회원가입 기능은 준비 중입니다.");
      }

      // 이용약관 메시지
      function showTermsMessage(event) {
        event.preventDefault();
        showAlert(
          "🎉 이용약관",
          "수환, 도현, 건우, 강일이에게 100점을 주겠다고 약속합니다!\n\n(진짜 이용약관 같은건 없어요 😄)"
        );
      }

      // 개인정보처리방침 메시지
      function showPrivacyMessage(event) {
        event.preventDefault();
        showAlert(
          "🎉 개인정보처리방침",
          "수환, 도현, 건우, 강일이에게 100점을 주겠다고 약속합니다!\n\n(진짜 개인정보처리방침 같은건 없어요 😄)"
        );
      }

      // 스크롤 애니메이션 초기화
      function initializeScrollAnimations() {
        const logoImage = document.querySelector(".logo-image");
        const brandText = document.querySelector(".brand-text");
        const signupCard = document.querySelector(".signup-card");

        // Intersection Observer 설정
        const observerOptions = {
          threshold: [0, 0.1, 0.3, 0.5, 0.7, 1],
          rootMargin: "-50px 0px -50px 0px",
        };

        const logoObserver = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            const ratio = entry.intersectionRatio;
            const target = entry.target;

            if (target === logoImage) {
              // 로고 이미지 애니메이션
              const rotation = ratio * 360;
              const scale = 0.5 + ratio * 0.5;
              const opacity = ratio;

              target.style.transform = `rotate(${rotation}deg) scale(${scale})`;
              target.style.opacity = opacity;
            }

            if (target === brandText) {
              // 브랜드 텍스트 애니메이션
              const translateY = (1 - ratio) * 50;
              const opacity = ratio;

              target.style.transform = `translateY(${translateY}px)`;
              target.style.opacity = opacity;
            }
          });
        }, observerOptions);

        // 카드 애니메이션을 위한 별도 Observer
        const cardObserver = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              const ratio = entry.intersectionRatio;
              const translateX = (1 - ratio) * 100;
              const opacity = ratio;
              const scale = 0.8 + ratio * 0.2;

              entry.target.style.transform = `translateX(${translateX}px) scale(${scale})`;
              entry.target.style.opacity = opacity;
            });
          },
          {
            threshold: [0, 0.2, 0.4, 0.6, 0.8, 1],
            rootMargin: "-100px 0px -100px 0px",
          }
        );

        // 스크롤 기반 패럴랙스 효과
        let ticking = false;

        function updateScrollAnimations() {
          const scrollY = window.scrollY;
          const windowHeight = window.innerHeight;
          const documentHeight = document.documentElement.scrollHeight;
          const scrollProgress = scrollY / (documentHeight - windowHeight);

          // 배경 장식 원들의 패럴랙스 효과
          const circles = document.querySelectorAll(".decoration-circle");
          circles.forEach((circle, index) => {
            const speed = (index + 1) * 0.5;
            const yPos = scrollY * speed;
            const rotation = scrollProgress * 360 * (index + 1);

            circle.style.transform = `translateY(${yPos}px) rotate(${rotation}deg)`;
          });

          // 로고 추가 효과
          if (logoImage) {
            const logoRect = logoImage.getBoundingClientRect();
            const logoCenter = logoRect.top + logoRect.height / 2;
            const windowCenter = windowHeight / 2;
            const distance = Math.abs(logoCenter - windowCenter);
            const maxDistance = windowHeight / 2;
            const proximity = Math.max(0, 1 - distance / maxDistance);

            // 중앙에 가까울수록 더 밝게
            const brightness = 1 + proximity * 0.3;
            const hueRotate = proximity * 20;

            logoImage.style.filter = `
              drop-shadow(0 8px 16px var(--shadow-color))
              brightness(${brightness})
              hue-rotate(${hueRotate}deg)
            `;
          }

          ticking = false;
        }

        function requestScrollUpdate() {
          if (!ticking) {
            requestAnimationFrame(updateScrollAnimations);
            ticking = true;
          }
        }

        // 이벤트 리스너 등록
        window.addEventListener("scroll", requestScrollUpdate, {
          passive: true,
        });

        // Observer 등록 (데스크톱에서만)
        if (!isMobile) {
          if (logoImage) logoObserver.observe(logoImage);
          if (brandText) logoObserver.observe(brandText);
          if (signupCard) cardObserver.observe(signupCard);
        }

        // 초기 상태 설정 (모바일에서는 애니메이션 비활성화)
        const isMobile = window.innerWidth <= 1024;

        if (logoImage && !isMobile) {
          logoImage.style.transition =
            "transform 0.3s ease, opacity 0.3s ease, filter 0.3s ease";
          logoImage.style.transform = "rotate(0deg) scale(0.5)";
          logoImage.style.opacity = "0";
        } else if (logoImage) {
          logoImage.style.opacity = "1";
          logoImage.style.transform = "rotate(0deg) scale(1)";
        }

        if (brandText && !isMobile) {
          brandText.style.transition = "transform 0.3s ease, opacity 0.3s ease";
          brandText.style.transform = "translateY(50px)";
          brandText.style.opacity = "0";
        } else if (brandText) {
          brandText.style.opacity = "1";
          brandText.style.transform = "translateY(0px)";
        }

        if (signupCard && !isMobile) {
          signupCard.style.transition =
            "transform 0.3s ease, opacity 0.3s ease";
          signupCard.style.transform = "translateX(100px) scale(0.8)";
          signupCard.style.opacity = "0";
        } else if (signupCard) {
          signupCard.style.opacity = "1";
          signupCard.style.transform = "translateX(0px) scale(1)";
        }

        // 페이지 로드 후 잠시 뒤에 애니메이션 시작
        setTimeout(() => {
          updateScrollAnimations();
        }, 100);
      }
    </script>

    <!-- 카카오 SDK 로드 (카카오 로그인 기능용) -->
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
  </body>
</html>
