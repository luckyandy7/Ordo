<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ordo - Reset Password</title>
    <link rel="stylesheet" href="/Login/styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Cutive:wght@400&family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      @font-face {
        font-family: "Freesentation";
        src: url("/font/Freesentation.ttf") format("truetype");
      }

      /* ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° í˜ì´ì§€ ì „ìš© ìŠ¤íƒ€ì¼ */
      .message-area {
        margin: 1.5rem 0;
        padding: 1rem;
        border-radius: var(--radius);
        text-align: center;
        font-size: 0.875rem;
        line-height: 1.5;
        min-height: 20px;
        transition: all 0.3s ease;
      }

      .message-area.success {
        background: rgba(34, 197, 94, 0.1);
        color: var(--success-color);
        border: 1px solid rgba(34, 197, 94, 0.2);
      }

      .message-area.error {
        background: rgba(239, 68, 68, 0.1);
        color: var(--error-color);
        border: 1px solid rgba(239, 68, 68, 0.2);
      }

      .temp-password {
        margin-top: 1rem;
        padding: 1rem;
        background: rgba(201, 99, 66, 0.05);
        border: 2px solid var(--copper-primary);
        border-radius: var(--radius);
        text-align: center;
      }

      .temp-password-label {
        font-size: 0.75rem;
        color: var(--text-secondary);
        margin-bottom: 0.5rem;
      }

      .temp-password-value {
        font-size: 1.25rem;
        font-weight: bold;
        color: var(--copper-primary);
        margin: 0.5rem 0;
        letter-spacing: 2px;
        background: white;
        padding: 0.5rem 1rem;
        border-radius: var(--radius-sm);
        display: inline-block;
        border: 1px solid var(--border);
      }

      .temp-password-note {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 0.5rem;
      }

      .info-note {
        font-size: 0.875rem;
        color: var(--text-muted);
      }
    </style>
</head>
<body class="loaded">
    <!-- í…Œë§ˆ í† ê¸€ ë²„íŠ¼ -->
    <button id="themeToggle" class="theme-toggle" title="ë‹¤í¬ëª¨ë“œ í† ê¸€">
        <span class="theme-icon">ğŸŒ™</span>
    </button>

    <div class="container">
        <!-- ì™¼ìª½ ë¸Œëœë”© ì„¹ì…˜ -->
        <div class="branding-section">
            <div class="brand-content">
                <div class="brand-header">
                    <img src="/Login/image-8.png" alt="Ordo Logo" class="brand-logo" />
                    <h1 class="brand-title font-cutive">Ordo</h1>
                </div>
                <h2 class="brand-headline">
                    <span class="font-cutive">Forgot your password?</span><br />
                    <span class="highlight font-cutive">We'll send you a reset link</span>
                </h2>
                <p class="brand-description">
                    ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠì–´ë²„ë¦¬ì…¨ë‚˜ìš”?<br />
                    ì´ë©”ì¼ë¡œ ì¬ì„¤ì • ë§í¬ë¥¼ ë³´ë‚´ë“œë¦´ê²Œìš”!
                </p>
            </div>
        </div>

        <!-- ì˜¤ë¥¸ìª½ ë¡œê·¸ì¸ í¼ -->
        <div class="form-section">
            <div class="login-card">
                <div class="login-header">
                    <h2 class="login-title">
                        <span class="font-cutive" style="color: #c96342">Reset Password</span>
                    </h2>
                    <p class="login-subtitle">
                        ë“±ë¡í•˜ì‹  ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•˜ì‹œë©´<br />
                        ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë°œê¸‰í•´ë“œë¦½ë‹ˆë‹¤.
                    </p>
                </div>

                <form id="forgotPasswordForm" class="login-form">
                    <div class="form-group">
                        <label for="email">ì´ë©”ì¼</label>
                        <div class="input-wrapper">
                            <span class="input-icon">ğŸ“§</span>
                            <input
                                type="email"
                                id="email"
                                name="email"
                                placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”"
                                required
                            />
                        </div>
                    </div>

                    <!-- ê¸°ì¡´ ë¡œê·¸ì¸ í˜ì´ì§€ì˜ form-optionsì™€ ë™ì¼í•œ êµ¬ì¡° -->
                    <div class="form-options">
                        <div class="info-note">
                            <span class="font-cutive">ì´ë©”ì¼ë¡œ ì¬ì„¤ì • ë§í¬ë¥¼ ë°›ìœ¼ì„¸ìš”</span>
                        </div>
                        <a href="/email-login" class="forgot-password">ë¡œê·¸ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
                    </div>

                    <button type="submit" class="login-btn" id="submitBtn">
                        <span class="btn-text font-cutive">Send Reset Password</span>
                        <div class="btn-loader"></div>
                    </button>
                </form>

                <!-- ê¸°ì¡´ ë¡œê·¸ì¸ í˜ì´ì§€ì˜ dividerì™€ ë™ì¼í•œ êµ¬ì¡° -->
                <div class="divider">
                    <span class="font-cutive">or</span>
                </div>

                <!-- ë©”ì‹œì§€ í‘œì‹œ ì˜ì—­ (ì†Œì…œ ë¡œê·¸ì¸ ì„¹ì…˜ ëŒ€ì‹ ) -->
                <div id="message" class="message-area"></div>

                <!-- ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸° -->
                <div class="signup-section">
                    <p class="signup-text">
                        <span class="font-cutive">Remember your password?</span>
                        <a href="/email-login" class="signup-link font-cutive">Back to Sign in</a>
                    </p>
                </div>
            </div>
        </div>

        <!-- ë°°ê²½ ì¥ì‹ -->
        <div class="bg-decoration">
            <div class="decoration-circle circle-1"></div>
            <div class="decoration-circle circle-2"></div>
            <div class="decoration-circle circle-3"></div>
        </div>
    </div>

    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p class="loading-text">ì²˜ë¦¬ ì¤‘...</p>
    </div>

    <!-- ì•Œë¦¼ ëª¨ë‹¬ -->
    <div id="alertModal" class="alert-modal">
        <div class="alert-content">
            <div class="alert-icon">âš ï¸</div>
            <h3 id="alertTitle">ì•Œë¦¼</h3>
            <p id="alertMessage">ë©”ì‹œì§€</p>
            <button id="alertOk" class="alert-btn">í™•ì¸</button>
        </div>
    </div>

    <script>
        // í…Œë§ˆ ê´€ë¦¬
        let currentTheme = localStorage.getItem("theme") || "light";

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í…Œë§ˆ ì ìš©
        document.addEventListener("DOMContentLoaded", () => {
            applyTheme(currentTheme);
            initializeForgotPassword();
            initializeScrollAnimations();

            // ë¡œë”© ì• ë‹ˆë©”ì´ì…˜
            setTimeout(() => {
                document.body.classList.remove("loading");
                document.body.classList.add("loaded");
            }, 100);
        });

        // í…Œë§ˆ ì ìš© í•¨ìˆ˜
        function applyTheme(theme) {
            document.documentElement.setAttribute("data-theme", theme);
            const themeIcon = document.querySelector(".theme-icon");
            if (themeIcon) {
                themeIcon.textContent = theme === "dark" ? "â˜€ï¸" : "ğŸŒ™";
            }
            localStorage.setItem("theme", theme);
        }

        // ìŠ¤í¬ë¡¤ ì• ë‹ˆë©”ì´ì…˜ ì´ˆê¸°í™” (ê¸°ì¡´ ë¡œê·¸ì¸ í˜ì´ì§€ í˜¸í™˜ì„±)
        function initializeScrollAnimations() {
            // í•„ìš”ì‹œ ì• ë‹ˆë©”ì´ì…˜ ë¡œì§ ì¶”ê°€
        }

        // ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜
        function showAlert(title, message, callback = null) {
            const modal = document.getElementById("alertModal");
            const titleElement = document.getElementById("alertTitle");
            const messageElement = document.getElementById("alertMessage");
            const okButton = document.getElementById("alertOk");

            titleElement.textContent = title;
            messageElement.textContent = message;
            modal.classList.add("show");

            okButton.onclick = () => {
                modal.classList.remove("show");
                if (callback) callback();
            };
        }

        // ë¡œë”© í‘œì‹œ í•¨ìˆ˜
        function showLoading(show) {
            const loadingOverlay = document.getElementById("loadingOverlay");
            if (show) {
                loadingOverlay.classList.add("show");
            } else {
                loadingOverlay.classList.remove("show");
            }
        }

        // ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ì´ˆê¸°í™”
        function initializeForgotPassword() {
            // í…Œë§ˆ í† ê¸€
            const themeToggle = document.getElementById("themeToggle");
            if (themeToggle) {
                themeToggle.addEventListener("click", () => {
                    currentTheme = currentTheme === "light" ? "dark" : "light";
                    applyTheme(currentTheme);
                });
            }

            // í¼ ì œì¶œ
            const forgotForm = document.getElementById("forgotPasswordForm");
            if (forgotForm) {
                forgotForm.addEventListener("submit", handleForgotPassword);
            }

            // ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ íš¨ê³¼
            const inputs = document.querySelectorAll("input");
            inputs.forEach((input) => {
                input.addEventListener("focus", () => {
                    input.parentElement.classList.add("focused");
                });

                input.addEventListener("blur", () => {
                    if (!input.value) {
                        input.parentElement.classList.remove("focused");
                    }
                });

                // ì´ë©”ì¼ ìœ íš¨ì„± ê²€ì‚¬
                if (input.type === "email") {
                    input.addEventListener("input", (e) => {
                        const email = e.target.value;
                        const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
                        
                        if (email && !isValid) {
                            e.target.style.borderColor = 'var(--error-color)';
                        } else {
                            e.target.style.borderColor = 'var(--border)';
                        }
                    });
                }
            });
        }

        // ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ì²˜ë¦¬
        async function handleForgotPassword(e) {
            e.preventDefault();

            const email = document.getElementById("email").value.trim();
            const messageElement = document.getElementById("message");
            const submitBtn = document.getElementById("submitBtn");
            const btnText = submitBtn.querySelector('.btn-text');

            // ìœ íš¨ì„± ê²€ì‚¬
            if (!email) {
                showMessage('error', 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì´ë©”ì¼ í˜•ì‹ ê²€ì‚¬
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showMessage('error', 'ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ë¡œë”© ìƒíƒœ
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');
            btnText.textContent = 'Sending...';
            showLoading(true);
            clearMessage();

            try {
                console.log('ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ìš”ì²­:', email);
                
                const response = await fetch('/api/forgot-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email })
                });
                
                console.log('ì‘ë‹µ ìƒíƒœ:', response.status);
                const data = await response.json();
                console.log('ì‘ë‹µ ë°ì´í„°:', data);
                
                if (response.ok) {
                    if (data.resetUrl && data.isLocalOnly) {
                        // ê°œë°œ í™˜ê²½ì—ì„œ ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨ ì‹œ ë§í¬ ì œê³µ
                        showMessage('success', `
                            <div>âš ï¸ ${data.message}</div>
                            <div class="temp-password">
                                <div class="temp-password-label">ê°œë°œ ëª¨ë“œ - ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë§í¬</div>
                                <div style="margin: 0.5rem 0;">
                                    <a href="${data.resetUrl}" 
                                       style="color: var(--copper-primary); text-decoration: underline; font-weight: bold;"
                                       target="_blank">
                                        ğŸ” ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì •í•˜ê¸° âœ
                                    </a>
                                </div>
                                <div class="temp-password-note">
                                    â° ë§í¬ëŠ” 1ì‹œê°„ ë™ì•ˆ ìœ íš¨í•©ë‹ˆë‹¤
                                </div>
                            </div>
                        `);
                    } else {
                        // ì •ìƒì ì¸ ì´ë©”ì¼ ë°œì†¡
                        showMessage('success', `
                            <div>âœ… ${data.message}</div>
                            <div style="margin-top: 1rem; font-size: 0.875rem; color: var(--text-muted);">
                                ğŸ“§ ë©”ì¼í•¨(ìŠ¤íŒ¸í•¨ í¬í•¨)ì„ í™•ì¸í•´ì£¼ì„¸ìš”<br>
                                ë§í¬ëŠ” <strong>1ì‹œê°„ ë™ì•ˆë§Œ</strong> ìœ íš¨í•©ë‹ˆë‹¤
                            </div>
                        `);

                        // 10ì´ˆ í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™ ì œì•ˆ
                        setTimeout(() => {
                            showAlert(
                                "ì´ë©”ì¼ í™•ì¸",
                                "ë©”ì¼í•¨ì„ í™•ì¸í•˜ì‹  í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ëŒì•„ê°€ì‹œê² ìŠµë‹ˆê¹Œ?",
                                () => {
                                    window.location.href = '/email-login';
                                }
                            );
                        }, 10000);
                    }
                } else {
                    showMessage('error', data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ì˜¤ë¥˜:', error);
                showMessage('error', 'ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            } finally {
                // ë¡œë”© ìƒíƒœ í•´ì œ
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
                btnText.textContent = 'Send Reset Password';
                showLoading(false);
            }
        }

        // ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showMessage(type, message) {
            const messageElement = document.getElementById("message");
            messageElement.className = `message-area ${type}`;
            messageElement.innerHTML = message;
        }

        // ë©”ì‹œì§€ ì´ˆê¸°í™” í•¨ìˆ˜
        function clearMessage() {
            const messageElement = document.getElementById("message");
            messageElement.className = 'message-area';
            messageElement.innerHTML = '';
        }
    </script>
</body>
</html> 