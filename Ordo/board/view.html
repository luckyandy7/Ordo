<!--
/**
 * ============================================
 * ğŸ‘ï¸ ORDO ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸° í˜ì´ì§€ (view.html)
 * ============================================
 * 
 * ğŸ“– ëª©ì : ì„ íƒí•œ ê²Œì‹œê¸€ì˜ ìƒì„¸ ë‚´ìš©ì„ í‘œì‹œí•˜ëŠ” í˜ì´ì§€
 * ğŸ¯ ê¸°ëŠ¥:
 *   - ê²Œì‹œê¸€ ì „ì²´ ë‚´ìš© í‘œì‹œ
 *   - ì‘ì„±ì ì •ë³´ ë° ë©”íƒ€ë°ì´í„° í‘œì‹œ
 *   - ì¢‹ì•„ìš” ê¸°ëŠ¥
 *   - ëŒ“ê¸€ ì‹œìŠ¤í…œ (ì‘ì„±, ìˆ˜ì •, ì‚­ì œ)
 *   - ê²Œì‹œê¸€ ìˆ˜ì •/ì‚­ì œ (ì‘ì„±ìë§Œ)
 *   - ì´ë¯¸ì§€ ëª¨ë‹¬ ë·°ì–´
 *   - íƒœê·¸ ì‹œìŠ¤í…œ
 * 
 * ğŸ”§ ì£¼ìš” ì»´í¬ë„ŒíŠ¸:
 *   - ê²Œì‹œê¸€ í—¤ë” (ì œëª©, ì‘ì„±ì, ë‚ ì§œ, ì¹´í…Œê³ ë¦¬)
 *   - ê²Œì‹œê¸€ ë³¸ë¬¸ (ë‚´ìš©, ì´ë¯¸ì§€)
 *   - ì•¡ì…˜ ë²„íŠ¼ (ì¢‹ì•„ìš”, ìˆ˜ì •, ì‚­ì œ)
 *   - ì¢‹ì•„ìš” ëª©ë¡ ì„¹ì…˜
 *   - ëŒ“ê¸€ ì„¹ì…˜ (ëª©ë¡, ì‘ì„± í¼)
 * 
 * ğŸ¨ ë””ìì¸ íŠ¹ì§•:
 *   - ì½ê¸° í¸í•œ íƒ€ì´í¬ê·¸ë˜í”¼
 *   - ì¹´ë“œ ê¸°ë°˜ ë ˆì´ì•„ì›ƒ
 *   - ì¸í„°ë™í‹°ë¸Œ ìš”ì†Œ (ì¢‹ì•„ìš”, ëŒ“ê¸€)
 *   - ì´ë¯¸ì§€ í™•ëŒ€ ë³´ê¸° ëª¨ë‹¬
 * 
 * ğŸ”— ì—°ê´€ íŒŒì¼:
 *   - list.html (ê²Œì‹œê¸€ ëª©ë¡)
 *   - write.html (ê²Œì‹œê¸€ ì‘ì„±)
 *   - edit.html (ê²Œì‹œê¸€ ìˆ˜ì •)
 * 
 * ì‘ì„±ì¼: 2025ë…„ 6ì›” 10ì¼
 * ì‘ì„±ì: ORDO ê°œë°œíŒ€
 * ë²„ì „: 1.0
 */
-->
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ordo - ê²Œì‹œê¸€ ë³´ê¸°</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cutive:wght@400&family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      @font-face {
        font-family: "Freesentation";
        src: url("/font/Freesentation.ttf") format("truetype");
      }

      :root {
        /* Ordo Signature Colors */
        --copper-primary: #c96342;
        --copper-light: #e08b6f;
        --copper-dark: #a54a2e;
        --copper-bright: #f2a085;
        --copper-shadow: rgba(201, 99, 66, 0.15);

        /* Modern Neutral Palette */
        --gray-50: #fafafa;
        --gray-100: #f5f5f5;
        --gray-200: #e5e5e5;
        --gray-300: #d4d4d4;
        --gray-400: #a3a3a3;
        --gray-500: #737373;
        --gray-600: #525252;
        --gray-700: #404040;
        --gray-800: #262626;
        --gray-900: #171717;

        /* Theme Colors */
        --background: #f6f0eb;
        --surface: #ffffff;
        --surface-hover: #f5f5f5;
        --border: #e5e5e5;
        --text-primary: #171717;
        --text-secondary: #525252;
        --text-muted: #a3a3a3;

        /* Shadows */
        --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
        --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1),
          0 2px 4px -2px rgb(0 0 0 / 0.1);
        --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1),
          0 4px 6px -4px rgb(0 0 0 / 0.1);
        --shadow-copper: 0 4px 14px 0 rgba(201, 99, 66, 0.15);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", "Freesentation", -apple-system, BlinkMacSystemFont,
          sans-serif;
        background: linear-gradient(
          135deg,
          var(--background) 0%,
          #faf4f2 50%,
          #f0e6e1 100%
        );
        background-attachment: fixed;
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
      }

      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border);
        padding: 1rem 0;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .header-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 2rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .brand-container {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .logo-image {
        width: 40px;
        height: 40px;
        transition: transform 0.3s ease;
      }

      .logo-image:hover {
        transform: rotate(15deg);
      }

      .brand {
        font-family: "Cutive", serif;
        font-size: 1.8rem;
        color: var(--copper-primary);
        font-weight: 400;
        text-decoration: none;
      }

      .nav-breadcrumb {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--text-secondary);
        font-size: 0.875rem;
      }

      .breadcrumb-link {
        color: var(--text-secondary);
        text-decoration: none;
        transition: color 0.2s ease;
      }

      .breadcrumb-link:hover {
        color: var(--copper-primary);
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 3rem 2rem;
      }

      .post-container {
        background: var(--surface);
        border-radius: 16px;
        box-shadow: var(--shadow-lg);
        overflow: hidden;
        margin-bottom: 2rem;
      }

      .post-header {
        padding: 2rem;
        border-bottom: 1px solid var(--border);
      }

      .post-category {
        display: inline-block;
        background: var(--copper-primary);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 16px;
        font-size: 0.8rem;
        margin-bottom: 1rem;
      }

      .post-title {
        font-family: "Cutive", serif;
        font-size: 2.5rem;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        line-height: 1.2;
      }

      .post-meta {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        flex-wrap: wrap;
        color: var(--text-secondary);
        font-size: 0.875rem;
        margin-bottom: 1rem;
      }

      .meta-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .author-info {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .author-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: var(--copper-primary);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.875rem;
      }

      .post-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-top: 1rem;
      }

      .tag {
        background: var(--gray-100);
        color: var(--text-secondary);
        padding: 0.25rem 0.75rem;
        border-radius: 16px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .tag:hover {
        background: var(--copper-light);
        color: white;
      }

      .post-content {
        padding: 2rem;
        font-size: 1.125rem;
        line-height: 1.8;
        color: var(--text-primary);
        word-break: break-word;
      }

      .post-content p {
        margin-bottom: 1.5rem;
      }

      .post-content ul,
      .post-content ol {
        margin-bottom: 1.5rem;
        padding-left: 2rem;
      }

      .post-content li {
        margin-bottom: 0.5rem;
      }

      .post-actions {
        padding: 1.5rem 2rem;
        border-top: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: var(--gray-50);
      }

      .action-buttons {
        display: flex;
        gap: 1rem;
      }

      .btn {
        padding: 0.5rem 1rem;
        border-radius: 8px;
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.2s ease;
        cursor: pointer;
        border: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-secondary {
        background: var(--surface);
        color: var(--text-secondary);
        border: 1px solid var(--border);
      }

      .btn-secondary:hover {
        background: var(--surface-hover);
        border-color: var(--copper-primary);
      }

      .btn-primary {
        background: var(--copper-primary);
        color: white;
      }

      .btn-primary:hover {
        background: var(--copper-dark);
      }

      .btn-warning {
        background: #f59e0b;
        color: white;
      }

      .btn-warning:hover {
        background: #d97706;
      }

      .btn-danger {
        background: #ef4444;
        color: white;
      }

      .btn-danger:hover {
        background: #dc2626;
      }

      #authorActions {
        display: flex;
        gap: 0.5rem;
        margin-left: 1rem;
      }

      .btn-like {
        background: var(--surface);
        color: var(--text-secondary);
        border: 2px solid var(--border);
        font-weight: 600;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .btn-like:hover {
        border-color: #ff6b6b;
        color: #ff6b6b;
        transform: translateY(-2px);
      }

      .btn-like.liked {
        background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        color: white;
        border-color: #ff6b6b;
        box-shadow: 0 4px 14px rgba(255, 107, 107, 0.3);
      }

      .btn-like.liked:hover {
        background: linear-gradient(135deg, #ff5252, #e53935);
        transform: translateY(-2px);
      }

      .btn-like .like-icon {
        transition: transform 0.2s ease;
      }

      .btn-like:hover .like-icon,
      .btn-like.liked .like-icon {
        transform: scale(1.2);
      }

      .post-stats {
        display: flex;
        gap: 1rem;
        color: var(--text-muted);
        font-size: 0.875rem;
      }

      .stat-item {
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }

      /* ì¢‹ì•„ìš” ì• ë‹ˆë©”ì´ì…˜ */
      @keyframes heartBeat {
        0% {
          transform: scale(1);
        }
        14% {
          transform: scale(1.3);
        }
        28% {
          transform: scale(1);
        }
        42% {
          transform: scale(1.3);
        }
        70% {
          transform: scale(1);
        }
      }

      .btn-like.animate .like-icon {
        animation: heartBeat 0.6s ease-in-out;
      }

      /* ì¢‹ì•„ìš” ëª©ë¡ */
      .likes-section {
        background: var(--surface);
        border-radius: 16px;
        box-shadow: var(--shadow-lg);
        overflow: hidden;
        margin-bottom: 2rem;
      }

      .likes-header {
        padding: 1.5rem 2rem;
        border-bottom: 1px solid var(--border);
        background: var(--gray-50);
      }

      .likes-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .likes-list {
        padding: 1rem 2rem;
        max-height: 300px;
        overflow-y: auto;
      }

      .like-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--border);
      }

      .like-item:last-child {
        border-bottom: none;
      }

      .like-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.875rem;
        font-weight: 600;
      }

      .like-info {
        flex: 1;
      }

      .like-user {
        font-weight: 500;
        color: var(--text-primary);
      }

      .like-date {
        font-size: 0.8rem;
        color: var(--text-muted);
      }

      .empty-likes {
        text-align: center;
        padding: 2rem;
        color: var(--text-secondary);
      }

      .comments-section {
        background: var(--surface);
        border-radius: 16px;
        box-shadow: var(--shadow-lg);
        overflow: hidden;
      }

      .comments-header {
        padding: 1.5rem 2rem;
        border-bottom: 1px solid var(--border);
        background: var(--gray-50);
      }

      .comments-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
      }

      .comments-list {
        max-height: 600px;
        overflow-y: auto;
      }

      .comment-item {
        padding: 1.5rem 2rem;
        border-bottom: 1px solid var(--border);
      }

      .comment-item:last-child {
        border-bottom: none;
      }

      .comment-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
      }

      .comment-meta {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .comment-actions {
        display: flex;
        gap: 0.5rem;
        opacity: 0;
        transition: opacity 0.2s;
      }

      .comment-item:hover .comment-actions {
        opacity: 1;
      }

      .comment-btn {
        background: none;
        border: none;
        cursor: pointer;
        padding: 0.25rem;
        border-radius: 4px;
        font-size: 0.875rem;
        transition: background-color 0.2s;
      }

      .comment-btn:hover {
        background-color: var(--border);
      }

      .edit-btn:hover {
        background-color: #fbbf24;
        color: white;
      }

      .delete-btn:hover {
        background-color: #ef4444;
        color: white;
      }

      .comment-author {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .comment-avatar {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        background: var(--copper-light);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        font-weight: 600;
      }

      .comment-date {
        color: var(--text-muted);
        font-size: 0.8rem;
      }

      .comment-content {
        color: var(--text-primary);
        line-height: 1.6;
        white-space: pre-wrap;
      }

      .comment-form {
        padding: 2rem;
        border-top: 1px solid var(--border);
        background: var(--gray-50);
      }

      .form-group {
        margin-bottom: 1rem;
      }

      .form-label {
        display: block;
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
      }

      .form-input {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid var(--border);
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.2s ease;
        background: var(--surface);
      }

      .form-input:focus {
        outline: none;
        border-color: var(--copper-primary);
        box-shadow: 0 0 0 3px var(--copper-shadow);
      }

      .form-textarea {
        min-height: 100px;
        resize: vertical;
        font-family: inherit;
      }

      .empty-comments {
        padding: 3rem 2rem;
        text-align: center;
        color: var(--text-secondary);
      }

      .empty-icon {
        font-size: 2rem;
        margin-bottom: 1rem;
        opacity: 0.5;
      }

      .loading {
        text-align: center;
        padding: 3rem;
        color: var(--text-secondary);
      }

      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid var(--border);
        border-top: 3px solid var(--copper-primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @media (max-width: 768px) {
        .container {
          padding: 2rem 1rem;
        }

        .post-title {
          font-size: 2rem;
        }

        .post-meta {
          flex-direction: column;
          align-items: flex-start;
          gap: 0.75rem;
        }

        .post-actions {
          flex-direction: column;
          gap: 1rem;
          align-items: flex-start;
        }

        .action-buttons {
          width: 100%;
          justify-content: space-between;
        }
      }

      /* ê²Œì‹œê¸€ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
      .post-images {
        margin: 2rem 0;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1rem;
      }

      .post-image-item {
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid var(--border);
        background: var(--surface);
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .post-image-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      }

      .post-image {
        width: 100%;
        height: 250px;
        object-fit: cover;
        display: block;
        transition: transform 0.3s ease;
      }

      .post-image:hover {
        transform: scale(1.05);
      }

      /* ì´ë¯¸ì§€ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
      .image-modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        align-items: center;
        justify-content: center;
        padding: 2rem;
      }

      .image-modal-content {
        position: relative;
        max-width: 90vw;
        max-height: 90vh;
        text-align: center;
      }

      .image-modal-img {
        max-width: 100%;
        max-height: 80vh;
        object-fit: contain;
        border-radius: 8px;
      }

      .image-modal-close {
        position: absolute;
        top: -40px;
        right: 0;
        color: white;
        font-size: 2rem;
        font-weight: bold;
        cursor: pointer;
        z-index: 1001;
      }

      .image-modal-close:hover {
        opacity: 0.7;
      }

      .image-modal-caption {
        color: white;
        margin-top: 1rem;
        font-size: 0.9rem;
        opacity: 0.8;
      }
    </style>
  </head>
  <body>
    <!-- ğŸ“Œ ìƒë‹¨ í—¤ë”: ë¸Œëœë“œëª… + ë¸Œë ˆë“œí¬ëŸ¼ ë„¤ë¹„ê²Œì´ì…˜ -->
    <header class="header">
      <div class="header-content">
        <div class="brand-container">
          <img src="/Login/image-8.png" alt="Ordo Logo" class="logo-image" />
          <a href="/Main/index.html" class="brand">Ordo</a>
        </div>
        <!-- ğŸ—ºï¸ ë¸Œë ˆë“œí¬ëŸ¼ ë„¤ë¹„ê²Œì´ì…˜ (ëŒ€ì‹œë³´ë“œ > ì»¤ë®¤ë‹ˆí‹° > ê²Œì‹œê¸€) -->
        <nav class="nav-breadcrumb">
          <a href="/Main/index.html" class="breadcrumb-link">ëŒ€ì‹œë³´ë“œ</a>
          <span>â€º</span>
          <a href="/board/list.html" class="breadcrumb-link">ì»¤ë®¤ë‹ˆí‹°</a>
          <span>â€º</span>
          <span>ê²Œì‹œê¸€</span>
        </nav>
      </div>
    </header>

    <!-- ğŸ  ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="container">
      <!-- ğŸ“– ê²Œì‹œê¸€ ì»¨í…Œì´ë„ˆ (ë™ì ìœ¼ë¡œ ë¡œë“œë¨) -->
      <div class="post-container" id="postContainer">
        <div class="loading">
          <div class="loading-spinner"></div>
          <p>ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>
      </div>

      <!-- â¤ï¸ ì¢‹ì•„ìš” ëª©ë¡ ì„¹ì…˜ -->
      <div class="likes-section" id="likesSection" style="display: none">
        <div class="likes-header">
          <h3 class="likes-title">
            <span>â¤ï¸</span>
            <span>ì¢‹ì•„ìš” <span id="likesTotalCount">0</span>ê°œ</span>
          </h3>
        </div>
        <div class="likes-list" id="likesList">
          <!-- ì¢‹ì•„ìš” ëª©ë¡ -->
        </div>
      </div>

      <!-- ğŸ’¬ ëŒ“ê¸€ ì„¹ì…˜ -->
      <div class="comments-section" id="commentsSection" style="display: none">
        <div class="comments-header">
          <h3 class="comments-title">
            ğŸ’¬ ëŒ“ê¸€ <span id="commentsCount">0</span>ê°œ
          </h3>
        </div>
        <div class="comments-list" id="commentsList">
          <!-- ëŒ“ê¸€ ëª©ë¡ -->
        </div>
        <form class="comment-form" id="commentForm">
          <div class="form-group">
            <label for="commentAuthor" class="form-label">ì‘ì„±ì</label>
            <input
              type="text"
              id="commentAuthor"
              class="form-input"
              placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
              required
            />
          </div>
          <div class="form-group">
            <label for="commentContent" class="form-label">ëŒ“ê¸€</label>
            <textarea
              id="commentContent"
              class="form-input form-textarea"
              placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•´ì£¼ì„¸ìš”"
              required
            ></textarea>
          </div>
          <button type="submit" class="btn btn-primary">ğŸ’¬ ëŒ“ê¸€ ì‘ì„±</button>
        </form>
      </div>
    </div>

    <!-- âš™ï¸ JavaScript: ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸° ê¸°ëŠ¥ êµ¬í˜„ -->
    <script>
      /**
       * ğŸŒ ì „ì—­ ë³€ìˆ˜ ì„ ì–¸
       */
      const postId = new URLSearchParams(window.location.search).get("id"); // URLì—ì„œ ê²Œì‹œê¸€ ID ì¶”ì¶œ
      let currentPost = null;   // í˜„ì¬ ê²Œì‹œê¸€ ë°ì´í„°
      let currentUser = null;   // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´
      let isLikeProcessing = false; // ì¢‹ì•„ìš” ì¤‘ë³µ í´ë¦­ ë°©ì§€ í”Œë˜ê·¸

      /**
       * ğŸ‘¤ ì‚¬ìš©ì ì¸ì¦ ìƒíƒœ í™•ì¸ í•¨ìˆ˜
       * - ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ í† í°ê³¼ ì‚¬ìš©ì ì •ë³´ í™•ì¸
       * - ì¸ì¦ ì‹¤íŒ¨ ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
       * @returns {boolean} ì¸ì¦ ì„±ê³µ ì—¬ë¶€
       */
      function checkUserAuthentication() {
        const token = localStorage.getItem("token");
        const user = localStorage.getItem("user");

        if (!token || !user) {
          console.log(
            "ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤."
          );
          alert("ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
          window.location.href = "/Login/email-login.html";
          return false;
        }

        try {
          currentUser = JSON.parse(user);
          if (!currentUser.name) {
            throw new Error("ì‚¬ìš©ì ì´ë¦„ì´ ì—†ìŠµë‹ˆë‹¤.");
          }
          return true;
        } catch (error) {
          console.error("ì‚¬ìš©ì ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:", error);
          alert("ì‚¬ìš©ì ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
          localStorage.removeItem("token");
          localStorage.removeItem("user");
          window.location.href = "/Login/email-login.html";
          return false;
        }
      }

      /**
       * ğŸ“± í˜ì´ì§€ ë¡œë”© ì™„ë£Œ í›„ ì´ˆê¸°í™”
       * - ê²Œì‹œê¸€ ID í™•ì¸
       * - ì‚¬ìš©ì ì¸ì¦ ìƒíƒœ í™•ì¸
       * - ê²Œì‹œê¸€, ëŒ“ê¸€, ì¢‹ì•„ìš” ë°ì´í„° ë¡œë“œ
       * - ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
       */
      document.addEventListener("DOMContentLoaded", async () => {
        if (!postId) {
          showError("ê²Œì‹œê¸€ IDê°€ ì—†ìŠµë‹ˆë‹¤.");
          return;
        }

        // ì‚¬ìš©ì ì¸ì¦ í™•ì¸
        if (!checkUserAuthentication()) {
          return; // ì¸ì¦ ì‹¤íŒ¨ ì‹œ ì—¬ê¸°ì„œ ì¢…ë£Œ
        }

        await loadPost();       // ê²Œì‹œê¸€ ë¡œë“œ
        await loadComments();   // ëŒ“ê¸€ ë¡œë“œ  
        await loadLikeStatus(); // ì¢‹ì•„ìš” ìƒíƒœ ë¡œë“œ
        setupCommentForm();     // ëŒ“ê¸€ í¼ ì„¤ì •
        setupLikeButton();      // ì¢‹ì•„ìš” ë²„íŠ¼ ì„¤ì •
      });

      /**
       * ğŸ“– ê²Œì‹œê¸€ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
       * - APIì—ì„œ ê²Œì‹œê¸€ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
       * - ì¡°íšŒìˆ˜ ì¦ê°€ ì²˜ë¦¬
       * - ê²Œì‹œê¸€ UI ë Œë”ë§
       */

      async function loadPost() {
        try {
          const response = await fetch(`/api/posts/${postId}`);
          if (!response.ok) throw new Error("Failed to fetch post");

          const data = await response.json();
          console.log("ë°›ì€ ê²Œì‹œê¸€ ë°ì´í„°:", data); // ë””ë²„ê¹…ìš©

          // ì„œë²„ ì‘ë‹µ í˜•íƒœì— ë”°ë¼ ì²˜ë¦¬
          currentPost = data.post || data;

          if (!currentPost.title) {
            console.error("ê²Œì‹œê¸€ ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤:", currentPost);
            throw new Error("ê²Œì‹œê¸€ ë°ì´í„°ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
          }

          renderPost(currentPost);

          // ì¡°íšŒìˆ˜ ì¦ê°€
          await updateViews();
        } catch (error) {
          console.error("ê²Œì‹œê¸€ ë¡œë”© ì˜¤ë¥˜:", error);
          showError("ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
      }

      function renderPost(post) {
        const container = document.getElementById("postContainer");

        // ì•ˆì „í•œ ë°ì´í„° ì²˜ë¦¬
        const title = post.title || "ì œëª© ì—†ìŒ";
        const author = post.author || "ìµëª…";
        const content = post.content || "";
        const category = post.category || "tips";

        console.log("ë Œë”ë§í•  ê²Œì‹œê¸€ ë°ì´í„°:", {
          title,
          author,
          content,
          category,
        }); // ë””ë²„ê¹…ìš©

        container.innerHTML = `
                <div class="post-header">
                    <div class="post-category">${getCategoryName(
                      category
                    )}</div>
                    <h1 class="post-title">${title}</h1>
                    <div class="post-meta">
                        <div class="author-info">
                            <div class="author-avatar">${author
                              .charAt(0)
                              .toUpperCase()}</div>
                            <span>${author}</span>
                        </div>
                        <div class="meta-item">
                            <span>ğŸ“…</span>
                            <span>${formatDate(post.createdAt)}</span>
                        </div>
                        <div class="meta-item">
                            <span>ğŸ‘€</span>
                            <span>${post.views || 0}íšŒ</span>
                        </div>
                    </div>
                    ${
                      post.tags && post.tags.length > 0
                        ? `
                        <div class="post-tags">
                            ${post.tags
                              .map((tag) => `<span class="tag">#${tag}</span>`)
                              .join("")}
                        </div>
                    `
                        : ""
                    }
                </div>
                <div class="post-content">
                    ${formatContent(content)}
                    ${renderPostImages(post.images || [])}
                </div>
                <div class="post-actions">
                    <div class="action-buttons">
                        <button class="btn btn-like" id="likeBtn">
                            <span class="like-icon">â¤ï¸</span>
                            <span id="likeText">ì¢‹ì•„ìš”</span>
                        </button>
                        <a href="/board/list.html" class="btn btn-secondary">ğŸ“‹ ëª©ë¡ìœ¼ë¡œ</a>
                        <a href="/board/write.html" class="btn btn-primary">âœï¸ ê¸€ì“°ê¸°</a>
                        <div id="authorActions" style="display: none;">
                            <a href="#" id="editBtn" class="btn btn-warning">âœï¸ ìˆ˜ì •</a>
                            <button id="deleteBtn" class="btn btn-danger">ğŸ—‘ï¸ ì‚­ì œ</button>
                        </div>
                    </div>
                    <div class="post-stats">
                        <div class="stat-item">
                            <span>ğŸ‘€</span>
                            <span>ì¡°íšŒ <span id="viewCount">${
                              post.views || 0
                            }</span></span>
                        </div>
                        <div class="stat-item">
                            <span>â¤ï¸</span>
                            <span>ì¢‹ì•„ìš” <span id="likesCount">${
                              post.likesCount || 0
                            }</span></span>
                        </div>
                        <div class="stat-item">
                            <span>ğŸ’¬</span>
                            <span>ëŒ“ê¸€ <span id="postCommentsCount">0</span></span>
                        </div>
                    </div>
                </div>
            `;

        // ì¢‹ì•„ìš” ì„¹ì…˜ê³¼ ëŒ“ê¸€ ì„¹ì…˜ í‘œì‹œ
        document.getElementById("likesSection").style.display = "block";
        document.getElementById("commentsSection").style.display = "block";

        // ì‘ì„±ì í™•ì¸í•˜ì—¬ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ í‘œì‹œ
        console.log("ì‘ì„±ì í™•ì¸:", {
          currentUserName: currentUser.name,
          postAuthor: author,
        }); // ë””ë²„ê¹…ìš©
        if (currentUser.name && author && currentUser.name === author) {
          document.getElementById("authorActions").style.display = "flex";
          setupAuthorActions();
        }

        // ì¢‹ì•„ìš” ë²„íŠ¼ ì„¤ì •
        setupLikeButton();
      }

      function renderPostImages(images) {
        if (!images || images.length === 0) {
          return "";
        }

        return `
          <div class="post-images">
            ${images
              .map(
                (image) => `
              <div class="post-image-item">
                <img
                  src="${
                    image.url || `/api/posts/images/${image.fileId || image.id}`
                  }"
                  alt="${image.originalName || image.name || "ì´ë¯¸ì§€"}"
                  class="post-image"
                  onclick="openImageModal(this.src, '${
                    image.originalName || image.name || "ì´ë¯¸ì§€"
                  }')"
                />
              </div>
            `
              )
              .join("")}
          </div>
        `;
      }

      function openImageModal(src, alt) {
        const modal = document.createElement("div");
        modal.className = "image-modal";
        modal.innerHTML = `
          <div class="image-modal-content">
            <span class="image-modal-close" onclick="closeImageModal()">&times;</span>
            <img src="${src}" alt="${alt}" class="image-modal-img">
            <div class="image-modal-caption">${alt}</div>
          </div>
        `;

        document.body.appendChild(modal);
        modal.style.display = "flex";

        // ESC í‚¤ë¡œ ë‹«ê¸°
        document.addEventListener("keydown", function (e) {
          if (e.key === "Escape") {
            closeImageModal();
          }
        });
      }

      function closeImageModal() {
        const modal = document.querySelector(".image-modal");
        if (modal) {
          modal.remove();
        }
      }

      async function loadLikeStatus() {
        try {
          const userId = currentUser.id || "";
          const response = await fetch(
            `/api/posts/${postId}/like-status?userId=${userId}`
          );
          if (!response.ok) throw new Error("Failed to fetch like status");

          const data = await response.json();
          updateLikeUI(data.isLiked, data.likesCount);
          renderLikes(data.likes || []);
        } catch (error) {
          console.error("ì¢‹ì•„ìš” ìƒíƒœ ë¡œë”© ì˜¤ë¥˜:", error);
        }
      }

      function setupLikeButton() {
        const likeBtn = document.getElementById("likeBtn");
        if (!likeBtn) return;

        likeBtn.addEventListener("click", async () => {
          if (!currentUser.id) {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            return;
          }

          // ì¤‘ë³µ í´ë¦­ ë°©ì§€
          if (isLikeProcessing) {
            console.log("ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.");
            return;
          }

          try {
            isLikeProcessing = true;
            likeBtn.disabled = true;
            likeBtn.style.opacity = "0.5";

            const response = await fetch(`/api/posts/${postId}/like`, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                userId: currentUser.id,
                userName: currentUser.name,
              }),
            });

            if (!response.ok) throw new Error("ì¢‹ì•„ìš” ì²˜ë¦¬ ì‹¤íŒ¨");

            const data = await response.json();

            // ì„œë²„ ì‘ë‹µìœ¼ë¡œ UI ì—…ë°ì´íŠ¸ (ì¤‘ë³µ ë¡œë”© ì œê±°)
            updateLikeUI(data.isLiked, data.likesCount);
            renderLikes(data.likes || []);

            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
            likeBtn.classList.add("animate");
            setTimeout(() => likeBtn.classList.remove("animate"), 600);
          } catch (error) {
            console.error("ì¢‹ì•„ìš” ì²˜ë¦¬ ì˜¤ë¥˜:", error);
            alert("ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          } finally {
            // 0.5ì´ˆ í›„ì— ë‹¤ì‹œ í´ë¦­ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •
            setTimeout(() => {
              isLikeProcessing = false;
              likeBtn.disabled = false;
              likeBtn.style.opacity = "1";
            }, 500);
          }
        });
      }

      function setupAuthorActions() {
        const editBtn = document.getElementById("editBtn");
        const deleteBtn = document.getElementById("deleteBtn");

        // ìˆ˜ì • ë²„íŠ¼
        if (editBtn) {
          editBtn.href = `/board/edit.html?id=${postId}`;
        }

        // ì‚­ì œ ë²„íŠ¼
        if (deleteBtn) {
          deleteBtn.addEventListener("click", async () => {
            if (
              !confirm(
                "ì •ë§ë¡œ ì´ ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì‚­ì œëœ ê²Œì‹œê¸€ì€ ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
              )
            ) {
              return;
            }

            deleteBtn.disabled = true;
            deleteBtn.innerHTML = "ğŸ—‘ï¸ ì‚­ì œ ì¤‘...";

            try {
              const response = await fetch(
                `/api/posts/${postId}?authorCheck=${encodeURIComponent(
                  currentUser.name
                )}`,
                {
                  method: "DELETE",
                }
              );

              const result = await response.json();

              if (response.ok) {
                alert("ê²Œì‹œê¸€ì´ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                window.location.href = "/board/list.html";
              } else {
                throw new Error(
                  result.message || "ê²Œì‹œê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."
                );
              }
            } catch (error) {
              console.error("ê²Œì‹œê¸€ ì‚­ì œ ì˜¤ë¥˜:", error);
              alert("ê²Œì‹œê¸€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);

              deleteBtn.disabled = false;
              deleteBtn.innerHTML = "ğŸ—‘ï¸ ì‚­ì œ";
            }
          });
        }
      }

      function updateLikeUI(isLiked, likesCount) {
        const likeBtn = document.getElementById("likeBtn");
        const likeText = document.getElementById("likeText");
        const likesCountEl = document.getElementById("likesCount");
        const likesTotalCountEl = document.getElementById("likesTotalCount");

        if (likeBtn) {
          if (isLiked) {
            likeBtn.classList.add("liked");
            likeText.textContent = "ì¢‹ì•„ìš” ì·¨ì†Œ";
          } else {
            likeBtn.classList.remove("liked");
            likeText.textContent = "ì¢‹ì•„ìš”";
          }
        }

        if (likesCountEl) {
          likesCountEl.textContent = likesCount || 0;
        }

        if (likesTotalCountEl) {
          likesTotalCountEl.textContent = likesCount || 0;
        }
      }

      function renderLikes(likes) {
        const container = document.getElementById("likesList");

        if (!likes || likes.length === 0) {
          container.innerHTML = `
            <div class="empty-likes">
              <div style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;">â¤ï¸</div>
              <p>ì•„ì§ ì¢‹ì•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.<br>ì²« ë²ˆì§¸ ì¢‹ì•„ìš”ë¥¼ ëˆŒëŸ¬ë³´ì„¸ìš”!</p>
            </div>
          `;
          return;
        }

        container.innerHTML = likes
          .sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt))
          .map(
            (like) => `
              <div class="like-item">
                <div class="like-avatar">${(like.userName || "?")
                  .charAt(0)
                  .toUpperCase()}</div>
                <div class="like-info">
                  <div class="like-user">${like.userName || "ìµëª…"}</div>
                  <div class="like-date">${formatDate(like.createdAt)}</div>
                </div>
              </div>
            `
          )
          .join("");
      }

      async function loadComments() {
        try {
          const response = await fetch(`/api/posts/${postId}/comments`);
          if (!response.ok) throw new Error("Failed to fetch comments");

          const comments = await response.json();
          renderComments(comments);
          updateCommentsCount(comments.length);
        } catch (error) {
          console.error("ëŒ“ê¸€ ë¡œë”© ì˜¤ë¥˜:", error);
          renderComments([]);
        }
      }

      function renderComments(comments) {
        const container = document.getElementById("commentsList");

        if (comments.length === 0) {
          container.innerHTML = `
                    <div class="empty-comments">
                        <div class="empty-icon">ğŸ’¬</div>
                        <p>ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.<br>ì²« ë²ˆì§¸ ëŒ“ê¸€ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
                    </div>
                `;
          return;
        }

        container.innerHTML = comments
          .map(
            (comment) => `
                <div class="comment-item" data-comment-id="${comment._id}">
                    <div class="comment-header">
                        <div class="comment-author">
                            <div class="comment-avatar">${(
                              comment.author || "?"
                            )
                              .charAt(0)
                              .toUpperCase()}</div>
                            <span>${comment.author || "ìµëª…"}</span>
                        </div>
                        <div class="comment-meta">
                            <span class="comment-date">${formatDate(
                              comment.createdAt
                            )}</span>
                            ${
                              currentUser.name &&
                              comment.author &&
                              currentUser.name === comment.author
                                ? `
                            <div class="comment-actions">
                                <button onclick="editComment('${
                                  comment._id
                                }', '${
                                    comment.text || comment.content
                                  }')" class="comment-btn edit-btn">âœï¸</button>
                                <button onclick="deleteComment('${
                                  comment._id
                                }')" class="comment-btn delete-btn">ğŸ—‘ï¸</button>
                            </div>
                            `
                                : ""
                            }
                        </div>
                    </div>
                    <div class="comment-content" id="comment-content-${
                      comment._id
                    }">${comment.text || comment.content}</div>
                </div>
            `
          )
          .join("");
      }

      function setupCommentForm() {
        const form = document.getElementById("commentForm");

        // ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ë¡œ ìë™ ì…ë ¥
        if (currentUser.name) {
          document.getElementById("commentAuthor").value = currentUser.name;
        }

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          await submitComment();
        });
      }

      async function submitComment() {
        const author = document.getElementById("commentAuthor").value;
        const content = document.getElementById("commentContent").value;

        if (!author.trim() || !content.trim()) {
          alert("ì‘ì„±ìì™€ ëŒ“ê¸€ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        try {
          const response = await fetch(`/api/posts/${postId}/comments`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              author: author.trim(),
              text: content.trim(),
            }),
          });

          if (response.ok) {
            // í¼ ì´ˆê¸°í™”
            document.getElementById("commentContent").value = "";

            // ëŒ“ê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            await loadComments();
          } else {
            throw new Error("ëŒ“ê¸€ ì‘ì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (error) {
          console.error("ëŒ“ê¸€ ì‘ì„± ì˜¤ë¥˜:", error);
          alert("ëŒ“ê¸€ ì‘ì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      async function updateViews() {
        try {
          await fetch(`/api/posts/${postId}/view`, {
            method: "POST",
          });
        } catch (error) {
          console.error("ì¡°íšŒìˆ˜ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:", error);
        }
      }

      function updateCommentsCount(count) {
        document.getElementById("commentsCount").textContent = count;
        const postCommentsCount = document.getElementById("postCommentsCount");
        if (postCommentsCount) {
          postCommentsCount.textContent = count;
        }
      }

      function getCategoryName(category) {
        const categories = {
          productivity: "ğŸ“ˆ ìƒì‚°ì„±",
          routine: "ğŸ”„ ë£¨í‹´",
          tips: "ğŸ’¡ íŒ",
          qna: "â“ ì§ˆë¬¸ë‹µë³€",
        };
        return categories[category] || "ğŸ’¡ íŒ";
      }

      function formatContent(content) {
        // contentê°€ ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´ ë°˜í™˜
        if (!content) {
          return "";
        }

        // ì¤„ë°”ê¿ˆì„ <br>ë¡œ ë³€í™˜í•˜ê³  ê¸°ë³¸ì ì¸ í¬ë§·íŒ… ì ìš©
        return content
          .replace(/\n/g, "<br>")
          .replace(/â€¢\s/g, "<br>â€¢ ")
          .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>");
      }

      function formatDate(dateString) {
        const date = new Date(dateString);
        const now = new Date();
        const diff = now - date;
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));

        if (days === 0) {
          const hours = Math.floor(diff / (1000 * 60 * 60));
          if (hours === 0) {
            const minutes = Math.floor(diff / (1000 * 60));
            return minutes <= 0 ? "ë°©ê¸ˆ ì „" : `${minutes}ë¶„ ì „`;
          }
          return `${hours}ì‹œê°„ ì „`;
        } else if (days === 1) {
          return "ì–´ì œ";
        } else if (days < 7) {
          return `${days}ì¼ ì „`;
        } else {
          return date.toLocaleDateString("ko-KR", {
            year: "numeric",
            month: "long",
            day: "numeric",
          });
        }
      }

      function showError(message) {
        const container = document.getElementById("postContainer");
        container.innerHTML = `
                <div style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                    <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;">âš ï¸</div>
                    <h2 style="margin-bottom: 1rem;">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h2>
                    <p style="margin-bottom: 2rem;">${message}</p>
                    <a href="/board/list.html" class="btn btn-primary">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
                </div>
            `;
      }

      // ëŒ“ê¸€ ìˆ˜ì • í•¨ìˆ˜
      async function editComment(commentId, currentText) {
        const newText = prompt("ëŒ“ê¸€ì„ ìˆ˜ì •í•˜ì„¸ìš”:", currentText);
        if (!newText || newText.trim() === "" || newText === currentText) {
          return;
        }

        try {
          const response = await fetch(
            `/api/posts/${postId}/comments/${commentId}?authorCheck=${encodeURIComponent(
              currentUser.name
            )}`,
            {
              method: "PUT",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                text: newText.trim(),
              }),
            }
          );

          const result = await response.json();

          if (response.ok) {
            // ëŒ“ê¸€ ë‚´ìš©ë§Œ ì—…ë°ì´íŠ¸
            const contentEl = document.getElementById(
              `comment-content-${commentId}`
            );
            if (contentEl) {
              contentEl.textContent = newText.trim();
            }
          } else {
            throw new Error(result.message || "ëŒ“ê¸€ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (error) {
          console.error("ëŒ“ê¸€ ìˆ˜ì • ì˜¤ë¥˜:", error);
          alert("ëŒ“ê¸€ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
        }
      }

      // ëŒ“ê¸€ ì‚­ì œ í•¨ìˆ˜
      async function deleteComment(commentId) {
        if (!confirm("ì •ë§ë¡œ ì´ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
          return;
        }

        try {
          const response = await fetch(
            `/api/posts/${postId}/comments/${commentId}?authorCheck=${encodeURIComponent(
              currentUser.name
            )}`,
            {
              method: "DELETE",
            }
          );

          const result = await response.json();

          if (response.ok) {
            // ëŒ“ê¸€ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            await loadComments();
          } else {
            throw new Error(result.message || "ëŒ“ê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (error) {
          console.error("ëŒ“ê¸€ ì‚­ì œ ì˜¤ë¥˜:", error);
          alert("ëŒ“ê¸€ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
        }
      }
    </script>
  </body>
</html>
