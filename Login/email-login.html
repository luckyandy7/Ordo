<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ordo - Sign in</title>
    <link rel="stylesheet" href="/Login/styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Cutive:wght@400&family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <style>
      @font-face {
        font-family: "Freesentation";
        src: url("/font/Freesentation.ttf") format("truetype");
      }
    </style>
  </head>
  <body class="loaded">
    <div class="container">
      <!-- í…Œë§ˆ í† ê¸€ ë²„íŠ¼ -->
      <button id="themeToggle" class="theme-toggle" title="ë‹¤í¬ëª¨ë“œ í† ê¸€">
        <span class="theme-icon">ğŸŒ™</span>
      </button>

      <!-- ì™¼ìª½ ë¸Œëœë”© ì„¹ì…˜ -->
      <div class="branding-section">
        <div class="brand-content">
          <div class="brand-header">
            <img src="/Login/image-8.png" alt="Ordo Logo" class="brand-logo" />
            <h1 class="brand-title font-cutive">Ordo</h1>
          </div>
          <h2 class="brand-headline">
            <span class="font-cutive">Welcome back to</span><br />
            <span class="highlight font-cutive">your organized life</span>
          </h2>
          <p class="brand-description">
            ë‹¤ì‹œ ë§Œë‚˜ì„œ ë°˜ê°€ì›Œìš”!<br />
            ì²´ê³„ì ì¸ ì¼ìƒìœ¼ë¡œ ëŒì•„ê°€ë³¼ê¹Œìš”?
          </p>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½ ë¡œê·¸ì¸ í¼ -->
      <div class="form-section">
        <div class="login-card">
          <div class="login-header">
            <h2 class="login-title">
              <span class="font-cutive">Sign in</span>
            </h2>
            <p class="login-subtitle">ê³„ì •ì— ë¡œê·¸ì¸í•˜ì—¬ ì¼ì •ì„ ê´€ë¦¬í•˜ì„¸ìš”</p>
          </div>

          <form id="loginForm" class="login-form">
            <div class="form-group">
              <label for="email">ì´ë©”ì¼</label>
              <div class="input-wrapper">
                <span class="input-icon">ğŸ“§</span>
                <input
                  type="email"
                  id="email"
                  name="email"
                  placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”"
                  required
                />
              </div>
            </div>

            <div class="form-group">
              <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
              <div class="input-wrapper">
                <span class="input-icon">ğŸ”’</span>
                <input
                  type="password"
                  id="password"
                  name="password"
                  placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                  required
                />
                <button
                  type="button"
                  class="password-toggle"
                  id="passwordToggle"
                >
                  ğŸ‘ï¸
                </button>
              </div>
            </div>

            <div class="form-options">
              <label class="remember-me">
                <input type="checkbox" id="rememberMe" />
                <span class="checkmark"></span>
                ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€
              </label>
              <a href="#" class="forgot-password">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</a>
            </div>

            <button type="submit" class="login-btn">
              <span class="btn-text font-cutive">Sign in</span>
              <div class="btn-loader"></div>
            </button>
          </form>

          <!-- ì†Œì…œ ë¡œê·¸ì¸ -->
          <div class="divider">
            <span class="font-cutive">or</span>
          </div>

          <div class="social-login">
            <button
              class="social-btn google-btn"
              onclick="location.href='/auth/google'"
            >
              <img src="/Login/logo-google-g-icon-1.svg" alt="Google" />
              <span class="font-cutive">Continue with Google</span>
            </button>

            <button class="social-btn kakao-btn" onclick="loginWithKakao()">
              <img src="/Login/KakaoTalk_logo.svg" alt="Kakao" />
              <span>Kakaoë¡œ ê³„ì†í•˜ê¸°</span>
            </button>
          </div>

          <!-- íšŒì›ê°€ì… ë§í¬ -->
          <div class="signup-section">
            <p class="signup-text">
              <span class="font-cutive">Don't have an account?</span>
              <a href="/Signup/signup.html" class="signup-link font-cutive"
                >Sign up</a
              >
            </p>
          </div>
        </div>
      </div>

      <!-- ë°°ê²½ ì¥ì‹ -->
      <div class="bg-decoration">
        <div class="decoration-circle circle-1"></div>
        <div class="decoration-circle circle-2"></div>
        <div class="decoration-circle circle-3"></div>
      </div>
    </div>

    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div id="loadingOverlay" class="loading-overlay">
      <div class="loading-spinner"></div>
      <p class="loading-text">ë¡œê·¸ì¸ ì¤‘...</p>
    </div>

    <!-- ì•Œë¦¼ ëª¨ë‹¬ -->
    <div id="alertModal" class="alert-modal">
      <div class="alert-content">
        <div class="alert-icon">âš ï¸</div>
        <h3 id="alertTitle">ì•Œë¦¼</h3>
        <p id="alertMessage">ë©”ì‹œì§€</p>
        <button id="alertOk" class="alert-btn">í™•ì¸</button>
      </div>
    </div>

    <script>
      // í…Œë§ˆ ê´€ë¦¬
      let currentTheme = localStorage.getItem("theme") || "light";

      // í˜ì´ì§€ ë¡œë“œ ì‹œ í…Œë§ˆ ì ìš©
      document.addEventListener("DOMContentLoaded", () => {
        applyTheme(currentTheme);
        initializeLogin();
        initializeScrollAnimations();

        // ë¡œë”© ì• ë‹ˆë©”ì´ì…˜
        setTimeout(() => {
          document.body.classList.remove("loading");
          document.body.classList.add("loaded");
        }, 100);
      });

      // í…Œë§ˆ ì ìš© í•¨ìˆ˜
      function applyTheme(theme) {
        document.documentElement.setAttribute("data-theme", theme);
        const themeIcon = document.querySelector(".theme-icon");
        if (themeIcon) {
          themeIcon.textContent = theme === "dark" ? "â˜€ï¸" : "ğŸŒ™";
        }
        localStorage.setItem("theme", theme);
      }

      // ë¡œê·¸ì¸ ì´ˆê¸°í™”
      function initializeLogin() {
        // í…Œë§ˆ í† ê¸€
        const themeToggle = document.getElementById("themeToggle");
        if (themeToggle) {
          themeToggle.addEventListener("click", () => {
            currentTheme = currentTheme === "light" ? "dark" : "light";
            applyTheme(currentTheme);
          });
        }

        // ë¹„ë°€ë²ˆí˜¸ í‘œì‹œ/ìˆ¨ê¹€
        const passwordToggle = document.getElementById("passwordToggle");
        const passwordInput = document.getElementById("password");

        if (passwordToggle && passwordInput) {
          passwordToggle.addEventListener("click", () => {
            const type =
              passwordInput.getAttribute("type") === "password"
                ? "text"
                : "password";
            passwordInput.setAttribute("type", type);
            passwordToggle.textContent = type === "password" ? "ğŸ‘ï¸" : "ğŸ™ˆ";
          });
        }

        // í¼ ì œì¶œ
        const loginForm = document.getElementById("loginForm");
        if (loginForm) {
          loginForm.addEventListener("submit", handleLogin);
        }

        // ì…ë ¥ í•„ë“œ í¬ì»¤ìŠ¤ íš¨ê³¼
        const inputs = document.querySelectorAll("input");
        inputs.forEach((input) => {
          input.addEventListener("focus", () => {
            input.parentElement.classList.add("focused");
          });

          input.addEventListener("blur", () => {
            if (!input.value) {
              input.parentElement.classList.remove("focused");
            }
          });
        });
      }

      // ë¡œê·¸ì¸ ì²˜ë¦¬
      async function handleLogin(e) {
        e.preventDefault();

        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const rememberMe = document.getElementById("rememberMe").checked;

        if (!email || !password) {
          showAlert("ì…ë ¥ ì˜¤ë¥˜", "ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
          return;
        }

        showLoading(true);

        try {
          const response = await fetch("/api/login", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              email,
              password,
              rememberMe,
            }),
          });

          const data = await response.json();

          if (response.ok) {
            // ì„œë²„ ì‘ë‹µ êµ¬ì¡°ì— ë§ê²Œ ë°ì´í„° ì¶”ì¶œ
            if (data.data && data.data.token && data.data.user) {
              localStorage.setItem("token", data.data.token);
              localStorage.setItem("user", JSON.stringify(data.data.user));

              console.log("ë¡œê·¸ì¸ ì„±ê³µ:", data.data.user);

              showAlert(
                "ë¡œê·¸ì¸ ì„±ê³µ",
                `í™˜ì˜í•©ë‹ˆë‹¤, ${data.data.user.name}ë‹˜! ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.`,
                () => {
                  window.location.href = "/Main/index.html";
                }
              );
            } else {
              showAlert("ë¡œê·¸ì¸ ì‹¤íŒ¨", "ì„œë²„ ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            }
          } else {
            showAlert("ë¡œê·¸ì¸ ì‹¤íŒ¨", data.message || "ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (error) {
          console.error("Login error:", error);
          showAlert(
            "ì—°ê²° ì˜¤ë¥˜",
            "ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
          );
        } finally {
          showLoading(false);
        }
      }

      // ë¡œë”© í‘œì‹œ
      function showLoading(show) {
        const overlay = document.getElementById("loadingOverlay");
        const loginBtn = document.querySelector(".login-btn");

        if (show) {
          overlay.classList.add("show");
          loginBtn.classList.add("loading");
          loginBtn.disabled = true;
        } else {
          overlay.classList.remove("show");
          loginBtn.classList.remove("loading");
          loginBtn.disabled = false;
        }
      }

      // ì•Œë¦¼ ëª¨ë‹¬
      function showAlert(title, message, callback) {
        const modal = document.getElementById("alertModal");
        const titleEl = document.getElementById("alertTitle");
        const messageEl = document.getElementById("alertMessage");
        const okBtn = document.getElementById("alertOk");

        titleEl.textContent = title;
        messageEl.textContent = message;
        modal.classList.add("show");

        okBtn.onclick = () => {
          modal.classList.remove("show");
          if (callback) callback();
        };
      }

      // ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸
      function loginWithKakao() {
        showAlert("ì¤€ë¹„ ì¤‘", "ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ê¸°ëŠ¥ì€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.");
      }

      // ìŠ¤í¬ë¡¤ ì• ë‹ˆë©”ì´ì…˜ ì´ˆê¸°í™”
      function initializeScrollAnimations() {
        const logoImage = document.querySelector(".logo-image");
        const brandText = document.querySelector(".brand-text");
        const loginCard = document.querySelector(".login-card");

        // Intersection Observer ì„¤ì •
        const observerOptions = {
          threshold: [0, 0.1, 0.3, 0.5, 0.7, 1],
          rootMargin: "-50px 0px -50px 0px",
        };

        const logoObserver = new IntersectionObserver((entries) => {
          entries.forEach((entry) => {
            const ratio = entry.intersectionRatio;
            const target = entry.target;

            if (target === logoImage) {
              // ë¡œê³  ì´ë¯¸ì§€ ì• ë‹ˆë©”ì´ì…˜
              const rotation = ratio * 360;
              const scale = 0.5 + ratio * 0.5;
              const opacity = ratio;

              target.style.transform = `rotate(${rotation}deg) scale(${scale})`;
              target.style.opacity = opacity;
            }

            if (target === brandText) {
              // ë¸Œëœë“œ í…ìŠ¤íŠ¸ ì• ë‹ˆë©”ì´ì…˜
              const translateY = (1 - ratio) * 50;
              const opacity = ratio;

              target.style.transform = `translateY(${translateY}px)`;
              target.style.opacity = opacity;
            }
          });
        }, observerOptions);

        // ì¹´ë“œ ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•œ ë³„ë„ Observer
        const cardObserver = new IntersectionObserver(
          (entries) => {
            entries.forEach((entry) => {
              const ratio = entry.intersectionRatio;
              const translateX = (1 - ratio) * 100;
              const opacity = ratio;
              const scale = 0.8 + ratio * 0.2;

              entry.target.style.transform = `translateX(${translateX}px) scale(${scale})`;
              entry.target.style.opacity = opacity;
            });
          },
          {
            threshold: [0, 0.2, 0.4, 0.6, 0.8, 1],
            rootMargin: "-100px 0px -100px 0px",
          }
        );

        // ìŠ¤í¬ë¡¤ ê¸°ë°˜ íŒ¨ëŸ´ë™ìŠ¤ íš¨ê³¼
        let ticking = false;

        function updateScrollAnimations() {
          const scrollY = window.scrollY;
          const windowHeight = window.innerHeight;
          const documentHeight = document.documentElement.scrollHeight;
          const scrollProgress = scrollY / (documentHeight - windowHeight);

          // ë°°ê²½ ì¥ì‹ ì›ë“¤ì˜ íŒ¨ëŸ´ë™ìŠ¤ íš¨ê³¼
          const circles = document.querySelectorAll(".decoration-circle");
          circles.forEach((circle, index) => {
            const speed = (index + 1) * 0.5;
            const yPos = scrollY * speed;
            const rotation = scrollProgress * 360 * (index + 1);

            circle.style.transform = `translateY(${yPos}px) rotate(${rotation}deg)`;
          });

          // ë¡œê³  ì¶”ê°€ íš¨ê³¼
          if (logoImage) {
            const logoRect = logoImage.getBoundingClientRect();
            const logoCenter = logoRect.top + logoRect.height / 2;
            const windowCenter = windowHeight / 2;
            const distance = Math.abs(logoCenter - windowCenter);
            const maxDistance = windowHeight / 2;
            const proximity = Math.max(0, 1 - distance / maxDistance);

            // ì¤‘ì•™ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ë” ë°ê²Œ
            const brightness = 1 + proximity * 0.3;
            const hueRotate = proximity * 20;

            logoImage.style.filter = `
              drop-shadow(0 8px 16px var(--shadow-color))
              brightness(${brightness})
              hue-rotate(${hueRotate}deg)
            `;
          }

          ticking = false;
        }

        function requestScrollUpdate() {
          if (!ticking) {
            requestAnimationFrame(updateScrollAnimations);
            ticking = true;
          }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        window.addEventListener("scroll", requestScrollUpdate, {
          passive: true,
        });

        // Observer ë“±ë¡ (ë°ìŠ¤í¬í†±ì—ì„œë§Œ)
        if (!isMobile) {
          if (logoImage) logoObserver.observe(logoImage);
          if (brandText) logoObserver.observe(brandText);
          if (loginCard) cardObserver.observe(loginCard);
        }

        // ì´ˆê¸° ìƒíƒœ ì„¤ì • (ëª¨ë°”ì¼ì—ì„œëŠ” ì• ë‹ˆë©”ì´ì…˜ ë¹„í™œì„±í™”)
        const isMobile = window.innerWidth <= 1024;

        if (logoImage && !isMobile) {
          logoImage.style.transition =
            "transform 0.3s ease, opacity 0.3s ease, filter 0.3s ease";
          logoImage.style.transform = "rotate(0deg) scale(0.5)";
          logoImage.style.opacity = "0";
        } else if (logoImage) {
          logoImage.style.opacity = "1";
          logoImage.style.transform = "rotate(0deg) scale(1)";
        }

        if (brandText && !isMobile) {
          brandText.style.transition = "transform 0.3s ease, opacity 0.3s ease";
          brandText.style.transform = "translateY(50px)";
          brandText.style.opacity = "0";
        } else if (brandText) {
          brandText.style.opacity = "1";
          brandText.style.transform = "translateY(0px)";
        }

        if (loginCard && !isMobile) {
          loginCard.style.transition = "transform 0.3s ease, opacity 0.3s ease";
          loginCard.style.transform = "translateX(100px) scale(0.8)";
          loginCard.style.opacity = "0";
        } else if (loginCard) {
          loginCard.style.opacity = "1";
          loginCard.style.transform = "translateX(0px) scale(1)";
        }

        // í˜ì´ì§€ ë¡œë“œ í›„ ì ì‹œ ë’¤ì— ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
        setTimeout(() => {
          updateScrollAnimations();
        }, 100);
      }
    </script>

    <!-- Kakao SDK -->
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <script>
      // Kakao.init("26c5560d99c31e4d37f7488343d18d09");
    </script>
  </body>
</html>
